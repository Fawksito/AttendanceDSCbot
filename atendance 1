import discord
from discord.ext import commands
import csv
import io

bot = commands.Bot(command_prefix='!')

@bot.event
async def on_ready():
    print(f'{bot.user} has connected to Discord!')

@bot.event
async def on_member_join(member):
    with open('attendance.csv', mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([member.name, member.id, 'Present'])

@bot.event
async def on_member_remove(member):
    with open('attendance.csv', mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([member.name, member.id, 'Absent'])

@bot.command(name='chupalo')
async def run_attendance_bot(ctx):
    await ctx.send('@here Attendance bot is now running. Please type "!present", "!tentative", or "!absent" to mark your attendance.')

@bot.command(name='present')
async def mark_present(ctx):
    with open('attendance.csv', mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([ctx.author.name, ctx.author.id, 'Present'])
    await ctx.send(f'{ctx.author.mention} marked as Present.')

@bot.command(name='tentative')
async def mark_tentative(ctx):
    with open('attendance.csv', mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([ctx.author.name, ctx.author.id, 'Tentative'])
    await ctx.send(f'{ctx.author.mention} marked as Tentative.')

@bot.command(name='absent')
async def mark_absent(ctx):
    with open('attendance.csv', mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([ctx.author.name, ctx.author.id, 'Absent'])
    await ctx.send(f'{ctx.author.mention} marked as Absent.')

@bot.command(name='exportar')
async def export_attendance(ctx):
    with open('attendance.csv', mode='r') as file:
        data = io.StringIO(file.read())
        await ctx.send(file=discord.File(data, filename='attendance.csv'))

bot.run('YOUR_BOT_TOKEN')
